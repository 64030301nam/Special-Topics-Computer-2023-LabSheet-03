# 3.2 การทำงานกับ ESP-IDF Project

## 1. การทำงานตามสภาวะเริ่มต้นของโปรเจค

### 1.1 เขียนโปรแกรมไฟกระพริบโดยเขียนทั้งหมดใน  main.c  โดยมีเงื่อนไขเบื้องต้นดังนี้

#### 1. ใช้ GPIO จำนวน 1 เส้น

 <img src="Pictures/Fig-01.png" alt="Fig 1" style="width:66%">

#### 2. จังหวะการกระพริบ ติด 0.5 วินาที ดับ 0.5 วินาที


```c
#include <unistd.h>      	// header for usleep()
#include "driver/gpio.h"	// header for gpio

const gpio_num_t LED1 = GPIO_NUM_23; 	//Define name 'GPIO_NUM_23' as 'LED1'

void app_main(void)
{
    gpio_set_direction(LED1, GPIO_MODE_OUTPUT);
    while (true)
    {
        gpio_set_level(LED1, 1);
        usleep(500000);
        gpio_set_level(LED1, 0);
        usleep(500000);
    }
}

```

### 1.2 เพิ่มฟังก์ชันต่อไปนี้ลงในไฟล์ main.c

#### 1. LED_INIT() เพื่อกำหนด GPIO ให้กับ LED

```c
void LED_Init()
{
    gpio_set_direction(LED1, GPIO_MODE_OUTPUT);
}
```

#### 2. LED_ON() เพื่อสั่งให้ LED ติด

```c
void LED_On()
{
    gpio_set_level(LED1, 1);
}
```

#### 3. LED_OFF() เพื่อสั่งให้ LED ดับ

```c
void LED_Off()
{
    gpio_set_level(LED1, 0);
}
```

#### 4. แก้ไข code ใน app_main() ให้เรียกใช้ฟังก์ชันของ LED

```c
void app_main(void)
{
    LED_Init();
    while (true)
    {
        LED_On();
        usleep(500000);
        LED_Off();
        usleep(500000);
    }
}
```



### 1.3 ทดสอบโดยการ build และรันโปรแกรม แก้ไขข้อบกพร่อง (ถ้ามี)

#### code โปรแกรมโดยสมบูรณ์

***หมายเหตุ***  ใช้สำหรับเป็นตัวอย่างเท่านั้น นักศึกษาควรเขียน code ทั้งหมดด้วยตนเอง

```c
#include <unistd.h>      	// header for usleep()
#include "driver/gpio.h"	// header for gpio

const gpio_num_t LED1 = GPIO_NUM_23; 	//Define name 'GPIO_NUM_23' as 'LED1'

void LED_Init()
{
    gpio_set_direction(LED1, GPIO_MODE_OUTPUT);
}

void LED_On()
{
    gpio_set_level(LED1, 1);
}

void LED_Off()
{
    gpio_set_level(LED1, 0);
}

void app_main(void)
{
    LED_Init();
    while (true)
    {
        LED_On();
        usleep(500000);
        LED_Off();
        usleep(500000);
    }
}
```


## 2. การเพิ่มไฟล์เข้าไปใน ESP-IDF Project

### 2.1 เพิ่มไฟล์ LED.h

ขั้นตอนการดำเนินการ
1. ใน ESP-IDF เรียกเมนู `File->New->Header File` จะปรากฏหน้าต่าง New Header File ทำตามขั้นตอนต่อไปนี้


 <img src="Pictures/Fig-02.png" alt="Fig 1" >



### 2.2 ย้าย code สำหรับ LED ไปไว้ใน LED.h และ LED.c

### 2.3 แก้ไข code ใน main.c ให้เรียกฟังก์ชันสำหรับใช้งาน LED

### 2.4 ทดลอง build โปรเจค มี error หรือไม่

### 2.5 แก้ไข Cmakelist.txt ให้มองเห็น LED.h และ build ไฟล์ LED.c 

### 2.6 ทดลอง build และ run โปรเจค